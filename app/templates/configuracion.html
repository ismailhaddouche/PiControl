{% extends 'base.html' %}

{% block title %}Configuración{% endblock %}

{% block content %}
  <h2>Configuración</h2>
  <p>Página de configuración básica. Aquí podrás cambiar ajustes de la aplicación.</p>

  {% if flash %}
    <div class="flash">{{ flash }}</div>
  {% endif %}

  <section>
    <h3>Usuario administrador</h3>
    <form method="post" action="/admin/configuracion/change_password">
      <div>
        <label>Nueva contraseña</label>
        <input type="password" name="new_password" required />
      </div>
      <div>
        <label>Confirmar contraseña</label>
        <input type="password" name="confirm_password" required />
      </div>
      <button type="submit">Cambiar contraseña</button>
    </form>
  </section>

  <section>
    <h3>Base de datos</h3>
    <p>
      <a class="button" href="/admin/configuracion/export_db">Descargar copia de la BD</a>
    </p>
    <form method="post" action="/admin/configuracion/import_db" enctype="multipart/form-data">
      <label>Importar archivo de base de datos (.db)</label>
      <input type="file" name="file" accept=".db,.sqlite" required />
      <button type="submit">Importar</button>
    </form>
    <p class="note">Al importar una BD, puede que sea necesario reiniciar el servidor.</p>
  </section>

  <section>
    <h3>Hora y Zona Horaria</h3>
    <form method="post" action="/admin/configuracion/set_timezone">
      <label>Zona horaria</label>
      <div>
        <select name="timezone" required>
          {% for tz in tz_list %}
            <option value="{{ tz }}" {% if tz == timezone %}selected{% endif %}>{{ tz }}</option>
          {% endfor %}
        </select>
      </div>
      <div style="margin-top:8px;">
        <button type="submit">Establecer zona horaria</button>
      </div>
    </form>
    <form method="post" action="/admin/configuracion/sync_time" style="margin-top:8px;">
      <button type="submit">Sincronizar hora (NTP)</button>
    </form>
  </section>

  <section>
    <h3>Actualizaciones</h3>
    <form method="post" action="/admin/configuracion/set_auto_update">
      <label>
        <input type="checkbox" name="enabled" {% if auto_update == 'true' %}checked{% endif %} /> Habilitar actualización automática
      </label>
      <button type="submit">Guardar</button>
    </form>
    <p class="note">La activación sólo guarda la preferencia; el mecanismo que aplique las actualizaciones automáticas debe implementarse en el entorno de despliegue (cron, servicio, etc.).</p>
  </section>

{% endblock %}
