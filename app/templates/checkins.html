{% extends 'base.html' %}

{% block title %}Check-in History{% endblock %}

{% block content %}
  <h2>Check-in History</h2>

  <!-- Filters form -->
  <section class="filters">
    <form method="get" action="/admin/fichajes" class="filters-form">
      <label for="start">From (date and time):</label>
      <input id="start" name="start" type="datetime-local" value="{{ filter.start if filter.start }}" />

      <label for="end">To (date and time):</label>
      <input id="end" name="end" type="datetime-local" value="{{ filter.end if filter.end }}" />

      <label for="empleado_sel">Employee:</label>
      <select id="empleado_sel" name="empleado_id">
        <option value="">-- All --</option>
        {% for e in employees %}
          <option value="{{ e.document_id }}" {% if filter.empleado_id and filter.empleado_id == e.document_id %}selected{% endif %}>{{ e.name }}</option>
        {% endfor %}
      </select>

      <button type="submit" class="btn">Apply filters</button>
      <a class="btn" href="/admin/fichajes">Clear</a>
    </form>
  </section>

  <section class="fichajes-list">
    {% if fichas and fichas|length > 0 %}
      <table class="table">
        <thead>
          <tr><th>Date</th><th>Employee</th><th>Type</th></tr>
        </thead>
        <tbody>
          {% for f in fichas %}
            <tr>
              <td>{{ f.timestamp|format_datetime }}</td>
              <td>{{ employees_map.get(f.empleado_id, f.empleado_id) }}</td>
              <td>{{ f.tipo }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>No records match the filters.</p>
    {% endif %}
  </section>
{% endblock %}
