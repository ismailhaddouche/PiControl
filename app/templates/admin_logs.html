{% extends 'base.html' %}

{% block title %}Administration Logs{% endblock %}

{% block content %}
  <h2>Administration Logs</h2>

  <form method="get" action="/admin/logs" class="filters">
    <label>From: <input type="datetime-local" name="start" value="{{ filter.start or '' }}"></label>
    <label>To: <input type="datetime-local" name="end" value="{{ filter.end or '' }}"></label>
    <label>Admin: <input type="text" name="admin" value="{{ filter.admin or '' }}"></label>
    <label>Action: <input type="text" name="action" value="{{ filter.action or '' }}"></label>
    <button type="submit" class="btn">Filter</button>
  </form>

  {% if entries and entries|length > 0 %}
    <table class="table">
      <thead>
        <tr><th>Date</th><th>Admin</th><th>Action</th><th>Details</th></tr>
      </thead>
      <tbody>
        {% for e in entries %}
          <tr>
            <td>{{ e.timestamp|format_datetime }}</td>
            <td>{{ e.admin_username or '-' }}</td>
            <td>{{ e.action }}</td>
            <td style="max-width:40rem; white-space:pre-wrap;">{{ e.details or '' }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="pagination">
      {% if page > 1 %}
        <a class="btn" href="?start={{ filter.start or '' }}&end={{ filter.end or '' }}&admin={{ filter.admin or '' }}&action={{ filter.action or '' }}&page={{ page-1 }}&page_size={{ page_size }}">Previous</a>
      {% endif %}
      <span>Page {{ page }}</span>
      {% if entries|length >= page_size %}
        <a class="btn" href="?start={{ filter.start or '' }}&end={{ filter.end or '' }}&admin={{ filter.admin or '' }}&action={{ filter.action or '' }}&page={{ page+1 }}&page_size={{ page_size }}">Next</a>
      {% endif %}
    </div>
  {% else %}
    <p>No entries match the filter.</p>
  {% endif %}

{% endblock %}
