{% extends 'base.html' %}

{% block title %}Admin Panel{% endblock %}

{% block content %}
  <h2>Admin Panel</h2>
  <p><a href="/admin/logs" class="btn">View admin logs</a></p>

  <!-- Zona superior: botón / formulario de registro manual -->
  <section class="manual-register">
    <h3>Manual check-in</h3>
    <form method="post" action="/admin/fichajes/manual" class="inline-form">
      <label for="empleado_select">Select employee:</label>
      <select id="empleado_select" name="empleado_id" required>
        <option value="">-- choose --</option>
        {% for e in employees %}
          <option value="{{ e.document_id }}">{{ e.name }}{% if e.rfid_uid %} ({{ e.rfid_uid }}){% endif %}</option>
        {% endfor %}
      </select>
      <button type="submit" class="btn">Register manually</button>
    </form>
    {% if flash %}
      <div class="flash success">{{ flash }}</div>
    {% endif %}
  </section>

  <!-- Zona inferior: últimos 20 registros -->
  <section class="recent-fichajes">
    <h3>Last 20 entries <small><a href="/admin/fichajes">(view full history)</a></small></h3>
    {% if recientes and recientes|length > 0 %}
      <table class="table">
        <thead>
          <tr><th>Fecha</th><th>Empleado</th><th>Tipo</th></tr>
        </thead>
        <tbody>
          {% for f in recientes %}
            <tr>
              <td>{{ f.timestamp|format_datetime }}</td>
              <td>{{ employees_map.get(f.empleado_id, f.empleado_id) }}</td>
              <td>{{ f.tipo }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>No recent entries.</p>
    {% endif %}
  </section>
{% endblock %}
