{% extends 'base.html' %}

{% block title %}Configuraci√≥n{% endblock %}

{% block content %}
  <h2>Settings</h2>
  <p>Basic application settings. Change configuration values here.</p>

  {% if flash %}
    <div class="flash">{{ flash }}</div>
  {% endif %}

  <section>
    <h3>Administrator</h3>
    <form method="post" action="/admin/configuracion/change_password">
      <div>
        <label>New password</label>
        <input type="password" name="new_password" required />
      </div>
      <div>
        <label>Confirm password</label>
        <input type="password" name="confirm_password" required />
      </div>
      <button type="submit">Change password</button>
    </form>
  </section>

  <section>
    <h3>Database</h3>
    <p>
      <a class="button" href="/admin/configuracion/export_db">Download DB copy</a>
    </p>
    <form method="post" action="/admin/configuracion/import_db" enctype="multipart/form-data">
      <label>Import database file (.db)</label>
      <input type="file" name="file" accept=".db,.sqlite" required />
      <button type="submit">Import</button>
    </form>
    <p class="note">Importing a DB may require restarting the server.</p>
  </section>

  <section>
    <h3>Time and Timezone</h3>
    <form method="post" action="/admin/configuracion/set_timezone">
      <label>Timezone</label>
      <div>
        <select name="timezone" required>
          {% for tz in tz_list %}
            <option value="{{ tz }}" {% if tz == timezone %}selected{% endif %}>{{ tz }}</option>
          {% endfor %}
        </select>
      </div>
      <div style="margin-top:8px;">
        <button type="submit">Set timezone</button>
      </div>
    </form>
    <form method="post" action="/admin/configuracion/sync_time" style="margin-top:8px;">
      <button type="submit">Sync time (NTP)</button>
    </form>
  </section>

  <section>
    <h3>Updates</h3>
    <form method="post" action="/admin/configuracion/set_auto_update">
      <label>
        <input type="checkbox" name="enabled" {% if auto_update == 'true' %}checked{% endif %} /> Enable automatic updates
      </label>
      <button type="submit">Save</button>
    </form>
    <p class="note">Enabling only saves the preference; the actual update mechanism must be implemented by the deployment (cron, service, etc.).</p>
  </section>

  <section>
    <h3>Services</h3>
    <p>Restart PiControl services. This action will be recorded in the audit logs.</p>
    <form method="post" action="/admin/restart" onsubmit="return confirm('Do you want to restart PiControl services now?');">
      <button type="submit">Restart PiControl services</button>
    </form>
    <p class="note">If installed system-wide and the installer configured permissions, the restart may not prompt for a password.</p>
  </section>

{% endblock %}
